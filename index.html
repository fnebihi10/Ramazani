<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Ramadan 2026 Tracker · Dhikr & Namaze</title>
    <!-- Font për ikona (FontAwesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #1a2a38 0%, #0f1e2b 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 12px;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            background: #fef9f0;
            border-radius: 40px 40px 30px 30px;
            box-shadow: 0 25px 40px -10px rgba(0,0,0,0.5);
            border: 1px solid rgba(201, 160, 61, 0.3);
            overflow: hidden;
            backdrop-filter: blur(2px);
        }

        .header {
            background: #1e2b36;
            padding: 28px 20px 20px;
            color: #fef9e7;
            text-align: center;
            border-bottom: 3px solid #c9a03d;
            position: relative;
        }

        .header h1 {
            font-weight: 400;
            font-size: 2.2rem;
            letter-spacing: 1px;
        }

        .header h1 span {
            font-weight: 300;
            font-size: 1rem;
            display: block;
            color: #c9a03d;
            margin-top: 5px;
            text-transform: uppercase;
        }

        .day-summary {
            background: #2a3b48;
            margin: 15px 15px 0 15px;
            padding: 15px;
            border-radius: 50px;
            display: flex;
            justify-content: space-around;
            color: white;
            font-size: 0.9rem;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .summary-item {
            text-align: center;
        }

        .summary-item i {
            color: #c9a03d;
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .summary-value {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .day-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fffcf2;
            padding: 12px 20px;
            border-bottom: 1px solid #e5d9c7;
        }

        .nav-btn {
            background: none;
            border: 2px solid #c9a03d;
            color: #1e2b36;
            font-size: 1.8rem;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            font-weight: bold;
        }

        .nav-btn:active {
            background: #c9a03d;
            color: white;
            transform: scale(0.95);
        }

        .day-display {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e2b36;
            background: #fef9e7;
            padding: 5px 20px;
            border-radius: 40px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .day-display small {
            font-size: 1rem;
            font-weight: 400;
            color: #7f8c8d;
        }

        .content {
            padding: 20px;
            padding-bottom: 30px;
            max-height: 70vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #c9a03d #f0e4d0;
        }

        .content::-webkit-scrollbar {
            width: 6px;
        }
        .content::-webkit-scrollbar-track {
            background: #f0e4d0;
            border-radius: 10px;
        }
        .content::-webkit-scrollbar-thumb {
            background: #c9a03d;
            border-radius: 10px;
        }

        .section {
            margin-bottom: 28px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 30px;
            padding: 18px 16px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(201,160,61,0.2);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e2b36;
            border-left: 6px solid #c9a03d;
            padding-left: 12px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-title i {
            color: #c9a03d;
            font-size: 1.4rem;
        }

        /* prayer grid */
        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }

        .prayer-item {
            background: white;
            border-radius: 50px;
            padding: 10px 16px 10px 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            border: 1px solid #e5d9c7;
            transition: 0.2s;
        }
        .prayer-item:hover {
            border-color: #c9a03d;
        }

        .prayer-item input[type="checkbox"] {
            width: 26px;
            height: 26px;
            accent-color: #c9a03d;
            border-radius: 8px;
        }

        .prayer-name {
            font-weight: 600;
            color: #1e2b36;
        }
        .prayer-name small {
            font-weight: 400;
            font-size: 0.7rem;
            color: #8e7b5e;
            display: block;
            line-height: 1.2;
        }

        /* voluntary prayer counters */
        .voluntary-counters {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .counter-card {
            background: white;
            border-radius: 30px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid #e5d9c7;
            box-shadow: 0 4px 8px rgba(0,0,0,0.03);
        }
        .counter-icon {
            background: #c9a03d20;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #c9a03d;
            font-size: 1.5rem;
        }
        .counter-info {
            flex: 2;
        }
        .counter-info strong {
            font-size: 1.1rem;
            color: #1e2b36;
        }
        .counter-info small {
            color: #8e7b5e;
            font-size: 0.8rem;
            display: block;
        }
        .counter-input {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f8f3e9;
            border-radius: 40px;
            padding: 5px 15px;
        }
        .counter-input input {
            width: 70px;
            border: none;
            border-bottom: 2px solid #c9a03d;
            background: transparent;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 5px 0;
        }
        .counter-input input:focus {
            outline: none;
        }
        .counter-input span {
            color: #5d6d7e;
            font-size: 0.9rem;
        }

        /* dhikr cards */
        .dhikr-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .dhikr-card {
            background: white;
            border-radius: 20px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            border: 1px solid #e5d9c7;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .dhikr-check {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 40px;
        }
        .dhikr-check input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: #c9a03d;
        }
        .dhikr-text {
            flex: 2;
            font-size: 0.95rem;
            color: #1e2b36;
            line-height: 1.4;
            min-width: 180px;
        }
        .arabic-note {
            font-size: 0.85rem;
            color: #c9a03d;
            font-style: italic;
        }
        .dhikr-counter {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f8f3e9;
            border-radius: 40px;
            padding: 4px 12px;
        }
        .dhikr-counter input {
            width: 65px;
            border: none;
            border-bottom: 1px solid #c9a03d;
            background: transparent;
            text-align: center;
            font-size: 1rem;
            padding: 4px 0;
        }
        .dhikr-counter input:focus {
            outline: none;
        }

        /* other inputs */
        .input-row {
            background: white;
            border-radius: 30px;
            padding: 14px 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid #e5d9c7;
        }
        .input-row label {
            font-weight: 600;
            min-width: 110px;
            color: #1e2b36;
        }
        .input-row input, .input-row textarea {
            flex: 1;
            border: none;
            border-bottom: 1px dashed #c9a03d;
            background: transparent;
            padding: 6px 0;
            font-size: 1rem;
        }
        .input-row textarea {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 8px;
            min-height: 60px;
        }
        .full-width {
            flex-direction: column;
            align-items: flex-start;
            gap: 6px;
        }
        .full-width textarea {
            width: 100%;
        }

        /* action buttons */
        .save-btn {
            background: #c9a03d;
            border: none;
            width: 100%;
            padding: 18px;
            font-size: 1.4rem;
            font-weight: 600;
            color: #1e2b36;
            border-radius: 60px;
            margin: 10px 0;
            box-shadow: 0 8px 0 #8f6f2c;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.1s;
        }
        .save-btn:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #8f6f2c;
        }
        .export-btn {
            background: transparent;
            border: 2px solid #c9a03d;
            color: #1e2b36;
            padding: 12px;
            border-radius: 50px;
            width: 100%;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            font-size: 1rem;
        }
        .export-btn i {
            margin-right: 8px;
        }
        .export-btn:active {
            background: #c9a03d20;
        }
        .footer-note {
            text-align: center;
            font-size: 0.8rem;
            color: #8e7b5e;
            margin: 20px 0 5px;
        }
    </style>
</head>
<body>
<div class="app-container" id="app">
    <div class="header">
        <h1>Ramadan 2026 <span>Ramadan Tracker</span></h1>
    </div>

    <!-- Përmbledhje e shpejtë ditore -->
    <div class="day-summary" id="daySummary">
        <div class="summary-item"><i class="fas fa-mosque"></i><div class="summary-value" id="summaryFarz">0/5</div><div>Farz</div></div>
        <div class="summary-item"><i class="fas fa-star-and-crescent"></i><div class="summary-value" id="summaryNafl">0</div><div>Nafl</div></div>
        <div class="summary-item"><i class="fas fa-moon"></i><div class="summary-value" id="summaryTahajjud">0</div><div>Tahaxhud</div></div>
        <div class="summary-item"><i class="fas fa-pray"></i><div class="summary-value" id="summaryTaraweeh">0/20</div><div>Teravi</div></div>
    </div>

    <div class="day-nav">
        <button class="nav-btn" id="prevDay"><i class="fas fa-chevron-left"></i></button>
        <div class="day-display" id="dayDisplay">Dita 1 <small>1 Ramazan</small></div>
        <button class="nav-btn" id="nextDay"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="content" id="content">
        <!-- will be filled by js -->
    </div>

    <div style="padding: 0 20px 20px;">
        <button class="save-btn" id="saveBtn"><i class="fas fa-save"></i> RUAJ</button>
        <button class="export-btn" id="exportBtn"><i class="fas fa-download"></i> Eksporto të dhënat</button>
        <div class="footer-note">Të dhënat ruhen vetëm në telefonin tuaj</div>
    </div>
</div>

<script>
    (function() {
        // ---------- Struktura e një dite (versioni 4) ----------
        const defaultDay = {
            prayers: {
                fajr: false,
                dhuhr: false,
                asr: false,
                maghrib: false,
                isha: false,
                naflRakats: '',       // numri i rekateve për nafl
                tahajjudRakats: '',    // numri i rekateve për tahaxhud
                taraweehRakats: ''     // numri i rekateve për teravi
            },
            quranPages: '',
            quranSurahs: '',
            dhikr: {
                subhanallah: { checked: false, count: '' },
                elhamdulilah: { checked: false, count: '' },
                allahuekber: { checked: false, count: '' },
                estagfirullah: { checked: false, count: '' },
                lailahaillallah_muhammad: { checked: false, count: '' },
                subhanallahi_ve_bi_hamdihi: { checked: false, count: '' },
                hasbijallahu: { checked: false, count: '' },
                lahawle: { checked: false, count: '' },
                salavatet: { checked: false, count: '' },
                lailahaillallah_wahdehu: { checked: false, count: '' },
                estagfirullaha_ve_etubu: { checked: false, count: '' },
                allahumma_inni_eseluke: { checked: false, count: '' },
                ihlas_felek_nas: { checked: false, count: '' },
                lailaha_illa_ente: { checked: false, count: '' },
                hasbijallahu_la_ilaha: { checked: false, count: '' }
            },
            dua: '',
            charity: '',
            reflection: ''
        };

        // Inicializo 30 ditë
        let ramadanData = [];
        for (let i = 0; i < 30; i++) {
            ramadanData.push(JSON.parse(JSON.stringify(defaultDay)));
        }

        // Ngarko nga localStorage (versioni i ri)
        const stored = localStorage.getItem('ramadan2026_data_v4');
        if (stored) {
            try {
                const parsed = JSON.parse(stored);
                if (Array.isArray(parsed) && parsed.length === 30) {
                    ramadanData = parsed.map(day => {
                        // Migrim nga versionet e vjetra (nëse kanë fusha boolean)
                        if (day.prayers && typeof day.prayers.nafl === 'boolean') {
                            day.prayers.naflRakats = day.prayers.nafl ? '2' : '';
                            delete day.prayers.nafl;
                        }
                        if (day.prayers && typeof day.prayers.tahajjud === 'boolean') {
                            day.prayers.tahajjudRakats = day.prayers.tahajjud ? '2' : '';
                            delete day.prayers.tahajjud;
                        }
                        if (!day.prayers.naflRakats) day.prayers.naflRakats = '';
                        if (!day.prayers.tahajjudRakats) day.prayers.tahajjudRakats = '';
                        if (!day.prayers.taraweehRakats) day.prayers.taraweehRakats = '';
                        return day;
                    });
                }
            } catch (e) {}
        }

        let currentDay = 0; // 0-based

        // Funksion për të rifreskuar përmbledhjen e shpejtë
        function updateSummary() {
            const d = ramadanData[currentDay];
            const farzCount = [d.prayers.fajr, d.prayers.dhuhr, d.prayers.asr, d.prayers.maghrib, d.prayers.isha].filter(Boolean).length;
            document.getElementById('summaryFarz').innerText = farzCount + '/5';

            const naflRak = d.prayers.naflRakats || 0;
            document.getElementById('summaryNafl').innerText = naflRak;

            const tahajjudRak = d.prayers.tahajjudRakats || 0;
            document.getElementById('summaryTahajjud').innerText = tahajjudRak;

            const taraweehRak = d.prayers.taraweehRakats || 0;
            document.getElementById('summaryTaraweeh').innerText = taraweehRak + '/20';
        }

        // ---------- Render formën për ditën aktuale ----------
        function renderDay() {
            const d = ramadanData[currentDay];
            const dayNum = currentDay + 1;

            let html = `
                <!-- NAMAZET FARZ -->
                <div class="section">
                    <div class="section-title"><i class="fas fa-mosque"></i> Namazet farz</div>
                    <div class="prayer-grid">
                        <div class="prayer-item"><input type="checkbox" id="fajr" ${d.prayers.fajr ? 'checked' : ''}><label for="fajr" class="prayer-name">Fajr <small>Sabahu</small></label></div>
                        <div class="prayer-item"><input type="checkbox" id="dhuhr" ${d.prayers.dhuhr ? 'checked' : ''}><label for="dhuhr" class="prayer-name">Dhuhr <small>Dreka</small></label></div>
                        <div class="prayer-item"><input type="checkbox" id="asr" ${d.prayers.asr ? 'checked' : ''}><label for="asr" class="prayer-name">Asr <small>Ikindija</small></label></div>
                        <div class="prayer-item"><input type="checkbox" id="maghrib" ${d.prayers.maghrib ? 'checked' : ''}><label for="maghrib" class="prayer-name">Maghrib <small>Akshami</small></label></div>
                        <div class="prayer-item"><input type="checkbox" id="isha" ${d.prayers.isha ? 'checked' : ''}><label for="isha" class="prayer-name">Isha <small>Jacia</small></label></div>
                    </div>
                </div>

                <!-- NAMAZET VULLNETARE (me numërues rekatesh) -->
                <div class="section">
                    <div class="section-title"><i class="fas fa-hands-praying"></i> Namazet vullnetare</div>
                    <div class="voluntary-counters">
                        <!-- Nafl -->
                        <div class="counter-card">
                            <div class="counter-icon"><i class="fas fa-sun"></i></div>
                            <div class="counter-info">
                                <strong>Nafl</strong>
                                <small>Namaz nafile</small>
                            </div>
                            <div class="counter-input">
                                <input type="number" id="naflRakats" min="0" max="100" step="1" value="${d.prayers.naflRakats}" placeholder="0">
                                <span>rekate</span>
                            </div>
                        </div>
                        <!-- Tahaxhud -->
                        <div class="counter-card">
                            <div class="counter-icon"><i class="fas fa-moon"></i></div>
                            <div class="counter-info">
                                <strong>Tahaxhud</strong>
                                <small>Namaz nate</small>
                            </div>
                            <div class="counter-input">
                                <input type="number" id="tahajjudRakats" min="0" max="100" step="1" value="${d.prayers.tahajjudRakats}" placeholder="0">
                                <span>rekate</span>
                            </div>
                        </div>
                        <!-- Teravitë -->
                        <div class="counter-card">
                            <div class="counter-icon"><i class="fas fa-star"></i></div>
                            <div class="counter-info">
                                <strong>Teravitë</strong>
                                <small>Namaz i teravive (20 rekate)</small>
                            </div>
                            <div class="counter-input">
                                <input type="number" id="taraweehRakats" min="0" max="20" step="1" value="${d.prayers.taraweehRakats}" placeholder="0">
                                <span>rekate</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KURANI -->
                <div class="section">
                    <div class="section-title"><i class="fas fa-book-open"></i> Kurani</div>
                    <div class="input-row"><label><i class="fas fa-book" style="color:#c9a03d; margin-right:8px;"></i>Faqe të lexuara:</label><input type="text" id="quranPages" placeholder="p.sh. 10" value="${escapeHtml(d.quranPages)}"></div>
                    <div class="input-row"><label><i class="fas fa-list" style="color:#c9a03d; margin-right:8px;"></i>Sure / Xhuz:</label><input type="text" id="quranSurahs" placeholder="p.sh. Jasin" value="${escapeHtml(d.quranSurahs)}"></div>
                </div>

                <!-- DHIKR & LUTJE (15 rreshtat) -->
                <div class="section">
                    <div class="section-title"><i class="fas fa-praying-hands"></i> Dhikr & Lutjet</div>
                    <div class="dhikr-grid">
            `;

            const dhikrList = [
                { id: 'subhanallah', label: '1. Subhanallah', arabic: 'سُبْحَانَ اللَّهِ', defaultCount: '100' },
                { id: 'elhamdulilah', label: '2. Elhamdulilah', arabic: 'الْحَمْدُ لِلَّهِ', defaultCount: '100' },
                { id: 'allahuekber', label: '3. Allahu Ekber', arabic: 'اللَّهُ أَكْبَرُ', defaultCount: '100' },
                { id: 'estagfirullah', label: '4. Estagfirullah', arabic: 'أَسْتَغْفِرُ اللَّهَ', defaultCount: '100' },
                { id: 'lailahaillallah_muhammad', label: '5. La ilahe illallah Muhamed Resulullah', arabic: 'لا إله إلا الله محمد رسول الله', defaultCount: '' },
                { id: 'subhanallahi_ve_bi_hamdihi', label: '6. SubhanAllahi ve bi hamdihi, SubhanAllahil Adhim', arabic: 'سُبْحَانَ اللَّهِ وَبِحَمْدِهِ سُبْحَانَ اللَّهِ الْعَظِيمِ', defaultCount: '' },
                { id: 'hasbijallahu', label: '7. HasbijAllahu ve ni\'mel vekil', arabic: 'حَسْبِيَ اللَّهُ وَنِعْمَ الْوَكِيلُ', defaultCount: '' },
                { id: 'lahawle', label: '8. La hawle ve la kuvvete illa billah', arabic: 'لا حَوْلَ وَلا قُوَّةَ إِلا بِاللَّهِ', defaultCount: '' },
                { id: 'salavatet', label: '9. Salavatet (salavate profetit)', arabic: 'اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ', defaultCount: '' },
                { id: 'lailahaillallah_wahdehu', label: '10. La ilahe illallah wahdehu la sherike leh…', arabic: 'لا إله إلا الله وحده لا شريك له...', defaultCount: '' },
                { id: 'estagfirullaha_ve_etubu', label: '11. Estagfirullaha ve etubu ilejh', arabic: 'أَسْتَغْفِرُ اللَّهَ وَأَتُوبُ إِلَيْهِ', defaultCount: '' },
                { id: 'allahumma_inni_eseluke', label: '12. Allahumme inni es’eluke’l xhenneh (7x)', arabic: 'اللَّهُمَّ إِنِّي أَسْأَلُكَ الْجَنَّةَ', defaultCount: '7' },
                { id: 'ihlas_felek_nas', label: '13. Ihlas, Felek, Nas', arabic: 'الإخلاص، الفلق، الناس', defaultCount: '' },
                { id: 'lailaha_illa_ente', label: '14. La ilahe illa ente subhaneke inni kuntu mine dhalimin', arabic: 'لا إله إلا أنت سبحانك إني كنت من الظالمين', defaultCount: '' },
                { id: 'hasbijallahu_la_ilaha', label: '15. HASBIJALLAHU LA ILAHE ILA HUVE… (teksti i plotë: Hasbijallahu la ilahe ila huve, alejhi tevekeltu ve huve rabbul arshil adhim)', arabic: 'حَسْبِيَ اللَّهُ لَا إِلَهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ', defaultCount: '' }
            ];

            dhikrList.forEach(item => {
                const dh = d.dhikr[item.id] || { checked: false, count: '' };
                const countValue = (dh.count === '' && item.defaultCount) ? item.defaultCount : dh.count;
                html += `
                    <div class="dhikr-card">
                        <div class="dhikr-check">
                            <input type="checkbox" id="${item.id}_chk" ${dh.checked ? 'checked' : ''}>
                        </div>
                        <div class="dhikr-text">
                            <strong>${item.label}</strong><br>
                            <span class="arabic-note">${item.arabic}</span>
                        </div>
                        <div class="dhikr-counter">
                            <input type="number" id="${item.id}_cnt" min="0" placeholder="numër" value="${countValue}">
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>

                <!-- LUTJA E DITËS -->
                <div class="section">
                    <div class="section-title"><i class="fas fa-heart"></i> Lutja e ditës</div>
                    <div class="input-row full-width">
                        <textarea id="dua" rows="3" placeholder="Shkruaj lutjen tënde...">${escapeHtml(d.dua)}</textarea>
                    </div>
                </div>

                <!-- BAMIRËSIA -->
                <div class="section">
                    <div class="section-title"><i class="fas fa-hand-holding-heart"></i> Bamirësia (sadaka)</div>
                    <div class="input-row">
                        <input type="text" id="charity" placeholder="Çfarë dhe sa?" value="${escapeHtml(d.charity)}">
                    </div>
                </div>

                <!-- REFLEKTIMI -->
                <div class="section">
                    <div class="section-title"><i class="fas fa-pen"></i> Reflektimi ditor</div>
                    <div class="input-row full-width">
                        <textarea id="reflection" rows="4" placeholder="Si u ndjeve sot? Çfarë mësove?">${escapeHtml(d.reflection)}</textarea>
                    </div>
                </div>
            `;

            document.getElementById('content').innerHTML = html;
            document.getElementById('dayDisplay').innerHTML = `Dita ${dayNum} <small>${dayNum} Ramazan 1446</small>`;
            updateSummary();
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe.replace(/[&<>"]/g, function(m) {
                if (m === '&') return '&amp;';
                if (m === '<') return '&lt;';
                if (m === '>') return '&gt;';
                if (m === '"') return '&quot;';
                return m;
            });
        }

        // ---------- Ruaj ditën aktuale ----------
        function saveCurrentDay() {
            const d = ramadanData[currentDay];

            // Farz
            d.prayers.fajr = document.getElementById('fajr')?.checked || false;
            d.prayers.dhuhr = document.getElementById('dhuhr')?.checked || false;
            d.prayers.asr = document.getElementById('asr')?.checked || false;
            d.prayers.maghrib = document.getElementById('maghrib')?.checked || false;
            d.prayers.isha = document.getElementById('isha')?.checked || false;

            // Vullnetare (rekate)
            const naflInput = document.getElementById('naflRakats');
            d.prayers.naflRakats = naflInput ? naflInput.value : '';
            const tahajjudInput = document.getElementById('tahajjudRakats');
            d.prayers.tahajjudRakats = tahajjudInput ? tahajjudInput.value : '';
            const taraweehInput = document.getElementById('taraweehRakats');
            d.prayers.taraweehRakats = taraweehInput ? taraweehInput.value : '';

            // Kurani
            d.quranPages = document.getElementById('quranPages')?.value || '';
            d.quranSurahs = document.getElementById('quranSurahs')?.value || '';

            // Dhikr
            const dhikrIds = [
                'subhanallah', 'elhamdulilah', 'allahuekber', 'estagfirullah',
                'lailahaillallah_muhammad', 'subhanallahi_ve_bi_hamdihi', 'hasbijallahu',
                'lahawle', 'salavatet', 'lailahaillallah_wahdehu', 'estagfirullaha_ve_etubu',
                'allahumma_inni_eseluke', 'ihlas_felek_nas', 'lailaha_illa_ente',
                'hasbijallahu_la_ilaha'
            ];

            dhikrIds.forEach(id => {
                const chk = document.getElementById(`${id}_chk`);
                const cnt = document.getElementById(`${id}_cnt`);
                if (chk && cnt) {
                    d.dhikr[id] = {
                        checked: chk.checked,
                        count: cnt.value
                    };
                }
            });

            d.dua = document.getElementById('dua')?.value || '';
            d.charity = document.getElementById('charity')?.value || '';
            d.reflection = document.getElementById('reflection')?.value || '';

            localStorage.setItem('ramadan2026_data_v4', JSON.stringify(ramadanData));
            updateSummary();
        }

        // ---------- Event listeners ----------
        document.getElementById('prevDay').addEventListener('click', function() {
            saveCurrentDay();
            if (currentDay > 0) {
                currentDay--;
                renderDay();
            } else {
                alert('Dita e parë.');
            }
        });

        document.getElementById('nextDay').addEventListener('click', function() {
            saveCurrentDay();
            if (currentDay < 29) {
                currentDay++;
                renderDay();
            } else {
                alert('Keni përfunduar 30 ditët!');
            }
        });

        document.getElementById('saveBtn').addEventListener('click', function() {
            saveCurrentDay();
            alert('Të dhënat u ruajtën!');
        });

        document.getElementById('exportBtn').addEventListener('click', function() {
            saveCurrentDay();
            const dataStr = JSON.stringify(ramadanData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ramadan2026_tracker_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Render fillestar
        renderDay();

        // Ruaj para se të mbyllet
        window.addEventListener('beforeunload', function() {
            saveCurrentDay();
        });
    })();
</script>
</body>
</html>
